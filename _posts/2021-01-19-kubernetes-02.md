# kubelet Garbage 수집

<https://kubernetes.io/ko/docs/concepts/cluster-administration/kubelet-garbage-collection/>


사용되지 않는 이미지들과 컨테이너들을 정리하는 kubelet의 유용한 기능. <br>
1분마다 컨테이너, 5분마다 이미지들에 대하여 가비지 수집을 수행.

<br>

## 이미지 수집 
이미지들에 대한 가비지 수집 정책은 다음의 2가지 요소를 고려한다. HighThresholdPercent 와 LowThresholdPercent. <br>
임계값을 초과하는 디스크 사용량은 가비지 수집을 트리거 한다. 가비지 수집은 낮은 입계값에 도달 할 때까지 최근에 가장 적게 사용한 이미지들을 삭제한다.

<br>

## 컨테이너 수집
컨테이너에 대한 가비지 수집 정책은 세 가지 <b>사용자 정의</b> 변수들을 고려한다.<br>
MinAge 는 컨테이너를 가비지 수집 할 수 있는 최소 연령이다. <br>
MaxPerPodContainer 파드당 최대 컨테이너 수,<br>
MaxContainers 죽은 컨테이너의 최대 수량이다.<br> 
이러한 변수는 MinAge 를 0으로 설정하고, MaxPerPodContainer 와 MaxContainers 를 각각 0 보다 작게 설정해서 비활성화 할 수 있다.<br><br>

kubelet은 위의 플래그들의 설정 경계를 벗어나거나, 확인되지 않은 컨테이너에 대해 조치를 취한다.<br>

일반적인 순서<br>
1. 가장 오래된 컨테이너 먼저 제거
2. MaxPerPodContainer가 허용가능한 범위에서, 전체 죽은 컨테이너의 수를 벗어나는 상황이 오면  MaxContainerssms 