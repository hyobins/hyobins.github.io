---
layout: post
published: On
title: Container별 Stats 정보 구하기
category: docker
subtitle: Docker container 별로 memory, cpu, network등 하드웨어 리소스 구하기
date: '2021-02-24'
---

## 1. docker api로 container id 받기


## 2. golang으로 cmd process를 생성하여 각 컨테이너별 pid 알아내기

<br>
실제 cmd 에시

```sh
[root@k8s-dev /]# cd run/docker/runtime-runc/moby/${container-id}
[root@k8s-dev ${container-id}]# ls
state.json
[root@k8s-dev ${container-id}]# cat state.json | grep pids
"pids":"/sys/fs/cgroup/pids/system.slice/docker-${container-id}.scope"}
```

단 이때 실제 pid가 아닌 경우도 있으니 golang의 directory exits 통해 확인하기

<br><br>

## 3. bytes, packets 를 파싱해서 전달  

```sh
cat /proc/$PID/net/dev
Inter-|   Receive                                                |  Transmit
 face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed
  eth0:  487276    3778    0    0    0     0          0         0   390223    3727    0    0    0     0       0          0
    lo:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0
```


